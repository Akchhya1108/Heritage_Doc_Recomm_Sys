═══════════════════════════════════════════════════════════════════════════════
                    LEARNING TO RANK - SYSTEM ARCHITECTURE
═══════════════════════════════════════════════════════════════════════════════

                              ┌─────────────────┐
                              │   USER QUERY    │
                              │  "mughal forts" │
                              └────────┬────────┘
                                       │
                    ┌──────────────────┴──────────────────┐
                    │                                     │
          ┌─────────▼────────┐              ┌────────────▼──────────┐
          │ Entity Extractor │              │   Query Complexity    │
          │ (NER/Ontology)   │              │     Estimator         │
          └─────────┬────────┘              └────────────┬──────────┘
                    │                                     │
                    │ ["mughal", "forts"]                │ complexity: 0.3
                    │                                     │
                    └──────────────────┬──────────────────┘
                                       │
                          ┌────────────▼────────────┐
                          │   QUERY CLASSIFIER      │
                          │   (RandomForest)        │
                          │                         │
                          │  Features:              │
                          │  - query_length: 2      │
                          │  - num_entities: 2      │
                          │  - has_question: no     │
                          │  - TF-IDF features      │
                          │                         │
                          │  Prediction:            │
                          │  → simple_keyword       │
                          │  → confidence: 0.75     │
                          └────────────┬────────────┘
                                       │
                          ┌────────────▼────────────┐
                          │    LTR MODEL            │
                          │  (LambdaMART/RankNet/   │
                          │   ListNet)              │
                          │                         │
                          │  Query Type Weights:    │
                          │  simple_keyword:        │
                          │    SimRank:   0.30      │
                          │    Horn:      0.20      │
                          │    Embedding: 0.50      │
                          │                         │
                          │  Confidence: 0.75       │
                          └────────────┬────────────┘
                                       │
        ┌──────────────────────────────┴──────────────────────────────┐
        │                                                              │
        │              COMPONENT SCORE COMPUTATION                     │
        │                                                              │
        │  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐       │
        │  │   SimRank   │  │   Horn's    │  │  Embedding   │       │
        │  │   (Graph)   │  │   Index     │  │  Similarity  │       │
        │  │             │  │  (Entity    │  │  (Semantic)  │       │
        │  │             │  │  Importance)│  │              │       │
        │  └─────┬───────┘  └──────┬──────┘  └──────┬───────┘       │
        │        │                 │                 │                │
        │    score: 0.62       score: 0.58      score: 0.85          │
        │        │                 │                 │                │
        └────────┼─────────────────┼─────────────────┼────────────────┘
                 │                 │                 │
                 │  weight: 0.30   │  weight: 0.20   │  weight: 0.50
                 │                 │                 │
                 └─────────────────┴─────────────────┘
                                   │
                      ┌────────────▼────────────┐
                      │  ENSEMBLE RANKER        │
                      │  (Fusion Method)        │
                      │                         │
                      │  Methods:               │
                      │  ┌─────────────────┐   │
                      │  │ RRF             │   │  ← Recommended
                      │  ├─────────────────┤   │
                      │  │ Cascade         │   │
                      │  ├─────────────────┤   │
                      │  │ Borda           │   │
                      │  ├─────────────────┤   │
                      │  │ CombMNZ         │   │
                      │  └─────────────────┘   │
                      │                         │
                      │  Auto-select based on:  │
                      │  - query_complexity     │
                      │  - num_entities         │
                      │                         │
                      │  Selected: RRF          │
                      └────────────┬────────────┘
                                   │
              ┌────────────────────┴────────────────────┐
              │                                         │
              │         FINAL RANKING                   │
              │                                         │
              │  1. Amber Fort (0.867)                 │
              │     └─ Primary: embedding (0.425)      │
              │                                         │
              │  2. Red Fort (0.723)                   │
              │     └─ Primary: SimRank (0.289)        │
              │                                         │
              │  3. Agra Fort (0.651)                  │
              │     └─ Primary: embedding (0.327)      │
              │                                         │
              │  ... (top-k results)                   │
              │                                         │
              └─────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                            TRAINING PIPELINE
═══════════════════════════════════════════════════════════════════════════════

  ┌───────────────────┐        ┌──────────────────┐
  │  Ground Truth     │        │   Recommender    │
  │  Annotations      │        │   Results        │
  │                   │        │                  │
  │  50 queries       │        │  Component       │
  │  × 10 docs        │        │  scores for all  │
  │  × relevance      │        │  query-doc pairs │
  │  (0-3 scale)      │        │                  │
  └─────────┬─────────┘        └────────┬─────────┘
            │                           │
            └───────────┬───────────────┘
                        │
            ┌───────────▼───────────┐
            │  Feature Extractor    │
            │                       │
            │  For each (q, d):     │
            │  - Component scores   │
            │  - Overlap features   │
            │  - Doc features       │
            │  - Query features     │
            │                       │
            │  → 18 features        │
            └───────────┬───────────┘
                        │
            ┌───────────▼───────────┐
            │  Training Dataset     │
            │                       │
            │  500+ samples         │
            │  (50 queries ×        │
            │   10 docs each)       │
            └───────────┬───────────┘
                        │
        ┌───────────────┴───────────────┐
        │                               │
        │      5-Fold Cross-Validation  │
        │                               │
    ┌───▼──────┐  ┌─────────┐  ┌──────▼───┐
    │LambdaMART│  │ RankNet │  │ ListNet  │
    │          │  │         │  │          │
    │100 trees │  │64 hidden│  │64 hidden │
    │depth=6   │  │epochs=50│  │epochs=50 │
    └───┬──────┘  └────┬────┘  └─────┬────┘
        │              │              │
        │     Train    │     Train    │    Train
        │              │              │
        ▼              ▼              ▼
    ┌───────────────────────────────────┐
    │   Extract Query-Type Weights      │
    │                                   │
    │   simple_keyword: [0.3, 0.2, 0.5]│
    │   entity_focused: [0.5, 0.4, 0.1]│
    │   concept_focused:[0.4, 0.2, 0.4]│
    │   complex_nlp:    [0.4, 0.3, 0.3]│
    └───────────────┬───────────────────┘
                    │
        ┌───────────▼───────────┐
        │  Evaluate on Test Set │
        │                       │
        │  Compute NDCG@10      │
        │  Compare models       │
        │  Select best          │
        └───────────┬───────────┘
                    │
        ┌───────────▼───────────┐
        │   Deploy to Prod      │
        │                       │
        │  Load trained model   │
        │  Use learned weights  │
        └───────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                          FEATURE IMPORTANCE
═══════════════════════════════════════════════════════════════════════════════

  From LambdaMART model (example):

  embedding_normalized     ████████████████████████  0.245
  simrank_normalized       ████████████████████      0.198
  horn_index_normalized    ███████████████           0.152
  domain_overlap           ███████████               0.108
  heritage_type_match      ██████████                0.095
  query_complexity         ████████                  0.078
  node_degree              ██████                    0.061
  doc_completeness         █████                     0.047
  ...

  → Semantic similarity (embedding) is most important
  → Graph structure (SimRank) is second
  → Entity importance (Horn) is third
  → Query-document overlap features add value

═══════════════════════════════════════════════════════════════════════════════
                       CONTINUOUS LEARNING LOOP
═══════════════════════════════════════════════════════════════════════════════

  ┌─────────────┐
  │   Users     │
  │   Query     │
  └──────┬──────┘
         │
         ▼
  ┌─────────────┐      ┌──────────────┐
  │ Recommender │─────>│   Results    │
  │ (LTR-based) │      │   Shown      │
  └─────────────┘      └──────┬───────┘
                              │
                              ▼
                       ┌──────────────┐
                       │ User Actions │
                       │ - Clicks     │
                       │ - Dwell time │
                       │ - Bookmarks  │
                       └──────┬───────┘
                              │
                              ▼
                       ┌──────────────┐
                       │   Log to DB  │
                       │ (interaction_│
                       │   logs)      │
                       └──────┬───────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Convert to      │
                    │ Implicit Labels │
                    │ (click+dwell>30s│
                    │  = relevant)    │
                    └─────────┬───────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Retrain Model   │
                    │ (monthly)       │
                    │                 │
                    │ old_data +      │
                    │ new_interactions│
                    └─────────┬───────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   A/B Test      │
                    │                 │
                    │ 90% old model   │
                    │ 10% new model   │
                    └─────────┬───────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Compare Metrics │
                    │                 │
                    │ If new > old:   │
                    │   Deploy new    │
                    └─────────────────┘

═══════════════════════════════════════════════════════════════════════════════
